"use strict";function getFeatureBBox(n){var r,e,o,t,i,a,l,f,u,g=n.geometry,s=g.type;if("Polygon"===s){i=g.coordinates,r=e=i[0][0][0],o=t=i[0][0][1];for(var v in i){a=i[v];for(var y in a)l=a[y],f=l[0],u=l[1],r=r>f?f:r,o=o>u?u:o,e=f>e?f:e,t=u>t?u:t}return[[o,r],[t,e]]}if("MultiPolygon"===s){var d=g.coordinates;r=e=d[0][0][0][0],o=t=d[0][0][0][1];for(var c in d){i=d[c];for(var P in i){a=i[P];for(var I in a)l=a[I],f=l[0],u=l[1],r=r>f?f:r,o=o>u?u:o,e=f>e?f:e,t=u>t?u:t}}return[[o,r],[t,e]]}}function getIndex(n,r){return r>0?n>0?1:2:0>n?3:4}function isPtInPolygon(n,r){for(var e=0,o=r.length,t=0;o>t;t++){var i=r[t],a=r[(t+1)%o],l=i[0]-n.lng,f=i[1]-n.lat,u=a[0]-n.lng,g=a[1]-n.lat,s=getIndex(u,g)-getIndex(l,f);if((1===s||-3===s)&&(e+=1),(-1===s||3===s)&&(e-=1),2===s||-2===s){var v=g*l-u*f;v>0?e+=2:e-=2}}return 4===Math.abs(e)?!0:!1}function isPtInPolygons(n,r){for(var e=0;e<r.length;e++)if(r[e]&&r[e][0]&&r[e][0][0]&&r[e][0][0][0]){if(isPtInPolygon(n,r[e][0]))return!0}else if(isPtInPolygon(n,r[e]))return!0;return!1}function simplyfys(n,r){for(var e=[],o=0;o<n.length;o++){var t=n[o],i=t.length,a=[],l=parseInt(Math.round(i/r),10);0===l&&(l=1);for(var f=0;i>f;f+=l)a.push(t[f]);e.push(a)}return e}function isPtInBound(n,r){var e=r[0],o=r[1];return n[0]<e[1]?!1:n[0]>o[1]?!1:n[1]<e[0]?!1:n[1]>o[0]?!1:!0}function divideby(n,r){return Math.round(n/r)*r}function gridfy(n,r,e){return r?(e=e||r,n.lat=divideby(n.lat,r),n.lng=divideby(n.lng,e),n):n}function traver(n,r){var e;for(var o in n)e=n[o],e&&"object"==typeof e&&r(o,e,n)&&traver(e,r)}function isNone(n){return null===n||void 0===n||isNaN(n)}function genIsPolygonInFeature(n,r){r=r||{};var e=r.bbox||getFeatureBBox(n),o=e[0][0],t=e[0][1],i=e[1][0],a=e[1][1],l=i-o,f=a-t,u=n.geometry,g=u.coordinates,s=u.type,v=r.scale||500,y=function(n,r){return{x:Math.floor((i-n)/l*v),y:Math.floor((a-r)/f*v)}},d=document.createElement("canvas");d.width=d.height=v;var c=d.getContext("2d");if(c.fillStyle="#000","polygon"===s.toLowerCase())for(var P in g){var I=g[P];for(var h in I){h=parseInt(h);var x=I[h],p=y(x[1],x[0]);0===h?(c.beginPath(),c.moveTo(p.x,p.y)):c.lineTo(p.x,p.y),h===I.length-1&&(c.fill(),console.log("done"),c.closePath())}}if("multipolygon"===s.toLowerCase())for(var P in g){var m=g[P];for(var b in m){var I=m[b];for(var h in I){h=parseInt(h);var x=I[h],p=y(x[1],x[0]);0===h?(c.beginPath(),c.moveTo(p.x,p.y)):c.lineTo(p.x,p.y),h===I.length-1&&(c.fill(),console.log("done"),c.closePath())}}}var B=c.getImageData(0,0,v,v).data;return function(n){var r=y(n.lat,n.lng),e=r.x+v*r.y;return B[4*e-1]>0}}module.exports={genIsPolygonInFeature:genIsPolygonInFeature,getFeatureBBox:getFeatureBBox,isPtInPolygons:isPtInPolygons,isPtInBound:isPtInBound,simplyfys:simplyfys,divideby:divideby,gridfy:gridfy,traver:traver,isNone:isNone};