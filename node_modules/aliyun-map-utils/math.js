"use strict";function getFeatureBBox(n){var r,t,o,e,a,i,l,f,g,u=n.geometry,s=u.type;if("Polygon"===s){a=u.coordinates,r=t=a[0][0][0],o=e=a[0][0][1];for(var y in a){i=a[y];for(var v in i)l=i[v],f=l[0],g=l[1],r=r>f?f:r,o=o>g?g:o,t=f>t?f:t,e=g>e?g:e}return[[o,r],[e,t]]}if("MultiPolygon"===s){var d=u.coordinates;r=t=d[0][0][0][0],o=e=d[0][0][0][1];for(var P in d){a=d[P];for(var c in a){i=a[c];for(var h in i)l=i[h],f=l[0],g=l[1],r=r>f?f:r,o=o>g?g:o,t=f>t?f:t,e=g>e?g:e}}return[[o,r],[e,t]]}}function getIndex(n,r){return r>0?n>0?1:2:0>n?3:4}function isPtInPolygon(n,r){for(var t=0,o=r.length,e=0;o>e;e++){var a=r[e],i=r[(e+1)%o],l=a[0]-n.lng,f=a[1]-n.lat,g=i[0]-n.lng,u=i[1]-n.lat,s=getIndex(g,u)-getIndex(l,f);if((1===s||-3===s)&&(t+=1),(-1===s||3===s)&&(t-=1),2===s||-2===s){var y=u*l-g*f;y>0?t+=2:t-=2}}return 4===Math.abs(t)?!0:!1}function isPtInPolygons(n,r){for(var t=0;t<r.length;t++)if(r[t]&&r[t][0]&&r[t][0][0]&&r[t][0][0][0]){if(isPtInPolygon(n,r[t][0]))return!0}else if(isPtInPolygon(n,r[t]))return!0;return!1}function simplyfys(n,r){for(var t=[],o=0;o<n.length;o++){var e=n[o],a=e.length,i=[],l=parseInt(Math.round(a/r),10);0===l&&(l=1);for(var f=0;a>f;f+=l)i.push(e[f]);t.push(i)}return t}function isPtInBound(n,r){var t=r[0],o=r[1];return n[0]<t[1]?!1:n[0]>o[1]?!1:n[1]<t[0]?!1:n[1]>o[0]?!1:!0}function divideby(n,r){return Math.round(n/r)*r}function gridfy(n,r,t){return r?(t=t||r,n.lat=divideby(n.lat,r),n.lng=divideby(n.lng,t),n):n}function genIsPolygonInFeature(n,r){r=r||{};var t=r.bbox||getFeatureBBox(n),o=t[0][0],e=t[0][1],a=t[1][0],i=t[1][1],l=a-o,f=i-e,g=n.geometry,u=g.coordinates,s=g.type,y=r.scale||500,v=function(n,r){return{x:Math.floor((a-n)/l*y),y:Math.floor((i-r)/f*y)}},d=document.createElement("canvas");d.width=d.height=y;var P=d.getContext("2d");if(P.fillStyle="#000","polygon"===s.toLowerCase())for(var c in u){var h=u[c];for(var I in h){I=parseInt(I);var m=h[I],x=v(m[1],m[0]);0===I?(P.beginPath(),P.moveTo(x.x,x.y)):P.lineTo(x.x,x.y),I===h.length-1&&(P.fill(),P.closePath())}}if("multipolygon"===s.toLowerCase())for(var c in u){var p=u[c];for(var B in p){var h=p[B];for(var I in h){I=parseInt(I);var m=h[I],x=v(m[1],m[0]);0===I?(P.beginPath(),P.moveTo(x.x,x.y)):P.lineTo(x.x,x.y),I===h.length-1&&(P.fill(),P.closePath())}}}var b=P.getImageData(0,0,y,y).data;return function(n){var r=v(n.lat,n.lng),t=r.x+y*r.y;return b[4*t-1]>0}}function randomPick(n){return n[Math.floor(Math.random()*n.length)]}module.exports={genIsPolygonInFeature:genIsPolygonInFeature,getFeatureBBox:getFeatureBBox,isPtInPolygons:isPtInPolygons,isPtInBound:isPtInBound,randomPick:randomPick,simplyfys:simplyfys,divideby:divideby,gridfy:gridfy};