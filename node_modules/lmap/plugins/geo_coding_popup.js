"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=require("./../leaflet"),a=require("bcore/utils"),i=require("bcore/event"),u=require("jquery"),s=r.dmap=r.dmap||{},c=function(i){function u(n,o){e(this,u);var r=t(this,(u.__proto__||Object.getPrototypeOf(u)).call(this));return r.addTo(n),o=r.options=a.deepMerge(u.options,o),r.reset(),r.initEventsMap(n),r}return n(u,i),o(u,[{key:"addTo",value:function(e){e&&(this._map=e)}},{key:"reset",value:function(){this.isable=!0}},{key:"initEventsMap",value:function(e){var t=this,n=this.options,o=n.search,a=n.text,i=n.eventType;"auto"===i&&(i=r.Browser.mobile?"touchstart":"dblclick");var u=function(n){if(t.isable){var i=t.getLatlng(n),u=r.popup().setLatLng(i).setContent("正在查询位置...").openOn(e);o(i,function(e){u.setContent(a(e))})}};r.DomEvent.on(e._container,i,u,this)}},{key:"enable",value:function(){this.isable=!0}},{key:"disable",value:function(){this.isable=!1}},{key:"getLatlng",value:function(e){var t=r.Browser.mobile?e.touches[0]:e,n=this._map,o=n.mouseEventToContainerPoint(t),a=n.containerPointToLayerPoint(o);return n.layerPointToLatLng(a)}}]),u}(i);c.options={eventType:"auto",search:function(e,t){var n="http://restapi.amap.com/v3/geocode/regeo?location="+e.lng+","+e.lat+"&key=767b3f050b17f8c713e3835b18f57ff9&callback=a";u.ajax({url:n,dataType:"jsonp",jsonpCallback:"a",success:function(e){if(e&&e.regeocode){var n=e.regeocode;if(n){var o=n.formatted_address,r=n.addressComponent;if(r)return r.formatted_address=o,0===r.length?null:void(t&&t(r))}}}})},text:function(e){var t=e.formatted_address;return 0===t.length?"无结果...":t}},s.GeoCodingSearch=c,s.geoCodingSearch=function(e,t){return new c(e,t)},module.exports=c;