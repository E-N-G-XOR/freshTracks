"use strict";function t(e,i){this.container=l.getContainer(e),i=arguments[arguments.length-1],this.options=l.deepMerge(t.options,i)}function e(t,e){for(var i,n=0;n<t.length;n++)i=t[n],i.style&&e(i)}function i(t,e){return e=e||10,"number"==typeof t&&(t=t.toString()),t.length>e?t.substring(0,e):t}function n(t,e,n,o,a){return t=i(t,a),e=i(e,o),'<div class="leaflet-popup-line" id="'+n+'">            <div class="leaflet-popup-name">'+e+': </div>            <a href="#'+t+'" class="leaflet-popup-value">'+t+"</a>          </div>"}function o(t,e,n,o,a){return t=i(t,a),e=i(e,o),'<div class="leaflet-popup-line" id="'+n+'">            <div class="leaflet-popup-name">'+e+': </div>            <input placeholder="'+t+'" class="leaflet-popup-value" value="'+t+'"></input>          </div>'}var a=require("./../leaflet"),l=require("bcore/utils"),s=require("bcore/event");require("./popup.css"),t.options={type:"list",colorValue:"#00ffe1",colorLine:"rgba(0,0,0,0.2)",colorKey:"#938c8c",background:"rgba(20,20,20,0.4)",limitName:8,limitValue:15},t=s.extend(t,{bindTo:function(){},updateStyle:function(){var t=this.options,i=this.container,n=i.parentNode,o=n.nextSibling.getElementsByClassName("leaflet-popup-tip")[0];n.style.background=o.style.background=t.background,e(i.getElementsByClassName("leaflet-popup-line"),function(e){e.style.color=t.colorKey}),e(i.getElementsByClassName("leaflet-popup-name"),function(e){e.style.color=t.colorKey}),e(i.getElementsByClassName("leaflet-popup-value"),function(e){e.style.color=t.colorValue})},data:function(t){this._data=t},render:function(t){t&&this.data(t),this.draw(),this.updateStyle(),this.initEvents()},getIncludeDefault:function(t){var t,e=[];for(var i in t)e.push({key:i});return e},draw:function(){var t=this._data,e=this,i=this.options.include||this.getIncludeDefault(t),n="";i.forEach(function(i){var o=i.key,a=i.name||o,l=t[o];l&&(n+=e.getHTML(l,a,o))}),this.container.style.width="auto",this.container.innerHTML=n},getHTML:function(t,e,i){var a=this.options,l=this.options.type||"list";return"record"===l?n(t,e,i,a.limitName,a.limitValue):"input"===l?o(t,e,i,a.limitName,a.limitValue):n(t,e,i,a.limitName,a.limitValue)},initEvents:function(){var t=this.options.type||"list";return"record"===t?this.initEventsLine():"input"===t?this.initEventsInput():"list"===t?this.initEventsLine():void this.initEventsLine()},initEventsLine:function(){var t=this.container.getElementsByClassName("leaflet-popup-line"),i=this,n=["click"];n.forEach(function(n){e(t,function(t){t.addEventListener(n,function(){var e=t.getAttribute("id");i.emit(n,{id:e,data:i._data,layer:i})})})})},initEventsInput:function(){},updateOptions:function(t){this.options=l.deepMerge(this.options,t),this.updateStyle()}});var u=a.dmap=a.dmap||{};u.Popup=t,u.popup=function(e){return t(e)},module.exports=t;