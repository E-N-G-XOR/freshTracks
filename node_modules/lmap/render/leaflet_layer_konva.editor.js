"use strict";var r=require("bcore/event"),e=require("bcore/utils"),t=require("./../leaflet"),i=require("konva");module.exports={initEditor:function(){var r=this.editorLayer=new i.Layer({"z-index":1e7});this.stage.add(r)},enableEditor:function(){var r=this.shapes;for(var e in r)r[e].setAttrs({draggable:!0});this.initEventEditor()},disableEditor:function(){var r=this.shapes;for(var e in r)r[e].setAttrs({draggable:!1});this.offEventEditor()},handlerDrag:function(r){this.disableMapEvents(r),this.isDraging=!0;var e,t=this.editorLayer,i=r.target;i&&(e=i.getLayer(),this.shapeActive=i,i.__startLayer=e,i.moveTo(t),e.draw(),t.draw(),i.startDrag())},handlerDrop:function(r){this.isDraging=!1,setTimeout(this.enableMapEvents.bind(this));var e=this.editorLayer,t=r.target;if(t.__startLayer||(t=this.shapeActive),t){var i=t.__startLayer;if(!i)return console.log("drag-error");t.moveTo(i),delete t.__startLayer,this.emit("shape-dragged",{shape:t}),e.draw(),i.draw(),this.shapeActive=null}},handlerDragging:function(){this.isDraging&&this._map.closePopup()},initEventEditor:function(){this.stage.on("mousedown.handlerDrag",this.handlerDrag.bind(this)).on("mouseup.handlerDrop",this.handlerDrop.bind(this)).on("dragmove.handlerDragging",this.handlerDragging.bind(this))},offEventEditor:function(){this.stage.off("mousedown.handlerDrag",this.handlerDrag.bind(this)).off("mouseup.handlerDrop",this.handlerDrop.bind(this)).off("dragmove.handlerDragging",this.handlerDragging.bind(this))}};