"use strict";function e(){}var t=require("./class"),s=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)?!0:!1};t.extend(e),module.exports=e,exports.EventEmitter=e;var n=100;e.prototype.setMaxListeners=function(e){this._events||(this._events={}),this._maxListeners=e},e.prototype.emit=function(){var e=arguments[0];if("error"===e&&(!this._events||!this._events.error||s(this._events.error)&&!this._events.error.length))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");if(!this._events)return!1;var t=this._events[e];if(!t)return!1;if("function"==typeof t){switch(arguments.length){case 1:t.call(this);break;case 2:t.call(this,arguments[1]);break;case 3:t.call(this,arguments[1],arguments[2]);break;default:for(var n=arguments.length,r=new Array(n-1),i=1;n>i;i++)r[i-1]=arguments[i];t.apply(this,r)}return!0}if(s(t)){for(var n=arguments.length,r=new Array(n-1),i=1;n>i;i++)r[i-1]=arguments[i];for(var o=t.slice(),i=0,n=o.length;n>i;i++)o[i].apply(this,r);return!0}return!1},e.prototype.addListener=function(e,t){if("function"!=typeof t)throw new Error("addListener only takes instances of Function");if(this._events||(this._events={}),this.emit("newListener",e,t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned){var r;r=void 0!==this._maxListeners?this._maxListeners:n,r&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("Possible mem-leak detected. event["+e+"] %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}return this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(e,t){function s(){n.removeListener(e,s),t.apply(this,arguments)}if("function"!=typeof t)throw new Error(".once only takes instances of Function");var n=this;return s.listener=t,n.on(e,s),this},e.prototype.removeListener=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");if(!this._events||!this._events[e])return this;var n=this._events[e];if(s(n)){for(var r=-1,i=0,o=n.length;o>i;i++)if(n[i]===t||n[i].listener&&n[i].listener===t){r=i;break}if(0>r)return this;n.splice(r,1),0==n.length&&delete this._events[e]}else(n===t||n.listener&&n.listener===t)&&delete this._events[e];return this},e.prototype.removeAllListeners=function(e){return 0===arguments.length?(this._events={},this):(e&&this._events&&this._events[e]&&(this._events[e]=null),this)},e.prototype.listeners=function(e){return this._events||(this._events={}),this._events[e]||(this._events[e]=[]),s(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]};