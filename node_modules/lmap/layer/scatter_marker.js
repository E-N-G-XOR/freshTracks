"use strict";function t(i){i=this.options=e.deepMerge(t.options,i),this.initialize(i)}var i=require("./../leaflet");require("./../render/canvas");var e=require("./../core/utils"),n=i.dmap=i.dmap||{},a=require("bcore/event"),r=e.EVENTS;require("./../index.css"),require("./scatter_marker.css");var o=i.Marker,t=a.extend(t,{initialize:function(){this.initDom()},initDom:function(){{var t=(this.options,i.divIcon({className:"circle-node",iconSize:[0,0]}));this.marker=new o([0,0],{icon:t})}},addTo:function(t){t&&(this._map=t,this.marker.addTo(t),this.initDomIcon(),this.initEvents())},initEvents:function(){var t=this,i=this.marker;r.forEach(function(e){i.on(e,function(){t.emit(e,{id:t.id,layer:t,data:t._data})})})},updatePopupPostion:function(){var t=this._map,i=this.textNode,e=this.options.hoverScale,n=i.offsetHeight/2*e,a=t.latLngToContainerPoint(this.center);a.y-=n,this.popupPosition=t.containerPointToLatLng(a)},initDomIcon:function(){var t=this.options.shape.html.bind(this);if(t){var i=this.marker,e=this.container=i._icon;t(e)}},updateOptions:function(t){this.options=e.deepMerge(this.options,t)},data:function(t){t&&(this._data=t,this.updateData(t))},updateData:function(t){t=t||this._data,this._data=t;var e=this.options,n=e.id,a=this.id=n(t);null!==a&&void 0!==a&&(this.id=a);var r=e.lng,o=e.lat,s=o(t),h=r(t);this.center=i.latLng(s,h),this.updateCenter(s,h);var c=e.text.bind(e);if(c){var d=c(t,this.textNode);this.updateText(void 0===d?"":d)}var u=(e.css||e.applyCss).bind(this),p=e.range||[];u&&u(t,this.textNode,p[0],p[1])},updateZIndex:function(){this._zIndex&&(this.container.style.zIndex=this._zIndex)},updateText:function(t){if(t!==this._text){this._text=t;var i=this.textNode;i&&(i.innerHTML=t)}},updateCenter:function(t,e){t&&e&&(t!==this._clat||e!==this._clng)&&(this._clat=t,this._clng=e,this.marker.setLatLng(i.latLng(t,e)))},render:function(t){t&&this.data(t),this.updatePopupPostion()},destroy:function(){this.marker.off(),this._map.removeLayer(this.marker)}});t.options={lat:e.getLat,lng:e.getLng,id:function(t){return t.id},hoverScale:1.2,css:function(){var t=10,i="#fff";return{background:i,left:-t,top:-t,width:2*t,height:2*t,"line-height":2*t+"px","border-radius":2*t}},text:function(t){return t.count},shape:{html:function(t){var i=document.createElement("div");i.className="interactive-circle",t.appendChild(i),this.textNode=i}}},n.ScatterMarker=t,n.scatterMarker=function(i){return new t(i)},module.exports=t;