"use strict";var t=require("./../leaflet"),i=require("jquery"),e=t.dmap=t.dmap||{},s=require("./../core/utils"),n=t.Class.extend({isRotateZ:!1,options:{column:{color:["red","blue"],width:10,height:30,deg:50,opacity:1},popuper:{color:"blue",width:75,height:15,borderRadius:1,opacity:1,top:20,left:-30}},initialize:function(t){this.options=s.deepMerge(this.options,t),this.columnOpts=this.options.column,this.popuperOpts=this.options.popuper},addTo:function(t){t&&(this._map=t)},data:function(t){this._data=t},init:function(){var t=(this.columns,this._data,this.columns=i('        <div class="line3d">          <div class="linedrawer">            <div class="lineLeft"></div>            <div class="lineRight"></div>          </div>          <div class="popuper"></div>          <div class="circlebottom"></div>          <div class="circletop"></div>        </div>'));i(".leaflet-marker-pane").append(t),this.line3dNode=t.find(".line3d"),this.linedrawerNode=t.find(".linedrawer"),this.lineLeft=t.find(".lineLeft"),this.lineRight=t.find(".lineRight"),this.popuperNode=t.find(".popuper"),this.initEventsMap()},render:function(){var t=this.columnOpts,e=t.width,s=t.color,n=2;i(".line3d").css({width:2*e+"px"}),i(".linedrawer").css({width:2*e+"px",height:n+"px",opacity:this.columnOpts.opacity}),i(".lineLeft").css({"background-color":s[0],width:e+"px"}),i(".lineRight").css({"background-color":s[1],"margin-left":e+"px",width:e+"px"}),this.updatePos(),this.rotate()},updatePos:function(i){var e=this._data,s=this._map,n=t.latLng(e.lng,e.lat);this.heightTransLeft=e.value[0]||40,this.heightTransRight=e.value[1]||40;var o;o=i?s._latLngToNewLayerPoint(n,i.zoom,i.center).round():s.latLngToLayerPoint(n);var r=o.x,a=o.y,h="translate3d("+r+"px,"+a+"px,0)",p=r+"px "+a+"px";this.linedrawerNode.css({height:this.heightTransLeft>this.heightTransRight?this.heightTransLeft:this.heightTransRight}),this.lineLeft.css({height:this.heightTransLeft}),this.lineRight.css({height:this.heightTransRight,"margin-top":"-"+this.heightTransLeft+"px"});var d=this.columns;d.css({transform:"rotateX(90deg)"+h,"-webkitTransform":"rotateX(90deg)"+h,"-webkitTransformOrigin":p,transformOrigin:p})},initEventsMap:function(){var t=this.updatePos.bind(this);this._map.on("zoomanim",t),requestAnimationFrame(function(){t()})},popUpper:function(){var t=this._data,e=(this._map,this.popuperNode),s=t.value[0],n=t.value[1];textRotator=i('<div class="text-rotator"><span class="span-text">value1 is '+s+" value2 is "+n+"</span></div>"),e.append(textRotator);var o=this.popuperOpts;textRotator.css({transform:"translate3d("+o.left+"px,"+o.top+"px,0px) rotateX(180deg)","background-color":o.color,width:o.width+"px",height:o.height+"px","border-radius":o.borderRadius+"px",opacity:o.opacity})},initEventsColumn:function(){i(".line3d").on("mouseover",function(t){i(t.currentTarget).find(".popuper").css("visibility","visible")}),i(".line3d").on("mouseout",function(t){i(t.currentTarget).find(".popuper").css("visibility","hidden")})},rotate:function(){this.angle=0,this.xdrag=0;{var t=this;i(this._map._container)}this._map.on("rotate",function(i){var e=-i.rotation;t.linedrawerNode.css({transform:"rotateY("+e+"deg)"}),t.popuperNode.css({transform:"rotateY("+e+"deg)"})})}});e.Bar3D=n,e.bar3d=function(t){return new e.Bar3D(t)},module.exports=n;