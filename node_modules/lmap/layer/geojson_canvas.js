"use strict";function t(e){e=this.options=i.deepMerge(t.options,e),this.updateStyle()}var e=require("./../leaflet"),n=require("bcore/event"),i=require("../core/utils"),o=require("./../render/canvas"),r=require("./../core/utils").getColorFunc,s=i.switchValue,a=e.dmap=e.dmap||{};t.options={container:"overlayPane",featureId:function(t,e){return t.properties&&t.properties.adcode?t.properties.adcode:e},id:function(){return d.adcode},value:function(t){return t.value},lat:function(t){return t[1]},lng:function(t){return t[0]},style:{lineWidth:2,fill:function(){return"#0ff"}}},t=n.extend(t,{init:function(){this.initCanvas()},initCanvas:function(){var t=this._map,e=this.options,n=e.container,i=this.dCanvas=new o(t,n,e);this.ctx=i.ctx},addTo:function(t){this._map=t,this.init(),this.initEventsMap()},updateStyle:function(){var t=this.options.style;t.fill&&(t.fill=r(t.fill)),t.stroke&&(t.stroke=r(t.stroke))},geojson:function(t){for(var e=t.features,n=this.options,i={},o=0;o<e.length;o++){var r=e[o],s=n.featureId(r,o);i[s]=r}this.features=i},data:function(t){var e=this.options;if(Array.isArray(t)){for(var n,i,o={},r=0;r<t.length;r++)n=t[r],i=e.id(n),o[i]=n;t=o}this._data=t},render:function(t){t&&this.data(t),this.draw()},draw:function(){var t=this.options,e=this._data||{},n=this.features;if(!n)return console.log("没有地理数据 -> geojsonCanvas.geojson(geojson)");var i,o,r,s,a=t.value.bind(t),l=0;for(id in n)i=n[id],o=i.geometry||i,s=e[id],s&&(l=a(s)),r=o.type,"MultiPolygon"===r?this.renderMultiPolygon(o,l):"Polygon"===r&&this.renderPolygon(o,l)},initEventsMap:function(){this.dCanvas.onUpdate(function(){this.draw()}.bind(this))},renderMultiPolygon:function(t,e){var n=this.ctx,i=this._map,o=this.options,r=o.lat,a=o.lng,l=o.style;l.fill&&(n.fillStyle=s(l.fill,e)),l.stroke&&(n.strokeStyle=s(l.stroke,e));for(var u,f,d,h,c,p,g=t.coordinates,v=0;v<g.length;v++){u=g[v];for(var y=0;y<u.length;y++){f=u[y],n.beginPath();for(var P,m=0;m<f.length;m++)d=f[m],c=r(d),p=a(d),h=i.latLngToContainerPoint({lat:c,lng:p}),0===m?(n.moveTo(h.x,h.y),P=h):n.lineTo(h.x,h.y),m===f.length-1&&n.lineTo(P.x,P.y);n.fill(),n.stroke(),n.closePath()}}},renderPolygon:function(t,e){var n=this.ctx,i=this._map,o=this.options,r=o.lat,a=o.lng,l=o.style;l.fill&&(n.fillStyle=s(l.fill,e)),l.stroke&&(n.strokeStyle=s(l.stroke,e)),l.lineWidth&&(n.lineWidth=l.lineWidth);for(var u,f,d,h,c,p=t.coordinates,g=0;g<p.length;g++){u=p[g],n.beginPath();for(var v=0;v<u.length;v++)f=u[v],h=r(f),c=a(f),d=i.latLngToContainerPoint({lat:h,lng:c}),0===v?n.moveTo(d.x,d.y):n.lineTo(d.x,d.y);n.fill(),n.stroke(),n.closePath()}}}),t.prototype.geoJson=t.prototype.geojson,e.dmap.geoJsonCanvas=function(e){return new t(e)},e.dmap.GeoJsonCanvas=t,module.exports=t;