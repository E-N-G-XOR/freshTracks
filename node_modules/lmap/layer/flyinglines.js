"use strict";function i(n){n=this.options=o.deepMerge(i.options,n)}var n=require("./../leaflet"),t=require("./flyingLineGradient"),e=require("./flyingLineDash"),s=require("bcore/event"),o=require("bcore/utils"),a=n.dmap=n.dmap||{};i.options={lineN:100,type:"gradient",flying:{lifeEnd:"hide",lifeSpeed:.01,kHeight:1.3,displayLine:{colorTo:"rgba(250,150,50,1)",colorFrom:"rgba(255,0,0,1)",colorNormal:"rgba(250,250,250,0.1)"},interactiveLine:{}}},i=s.extend(i,{isInit:!1,isLive:!0,life:0,addTo:function(i){return this._map=i,this.isable=!0,this.init(),this.initEvents(),this},init:function(){var i=this.options,n=i.lineN,s=i.flying,o=this._map,a={gradient:t,dash:e}[i.type],u=this.unusing=[];this.using=[];for(var h,r=this.lines=[],l=0;n>l;l++)h=new a(s),h.addTo(o),this.initEventsLine(h),u.push(h),r.push(h);this.loop()},data:function(i){this._data=i},render:function(i){i&&this.data(i),this.draw()},draw:function(){var i,n,t=this._data,e=this.using,s=this.unusing;for(var o in t)i=t[o],s.length&&i&&(n=s.pop(),n.data(i),n.resume(),e.push(n))},checkLine:function(i,n,t){i.life<=i.options.lifeMax+i.options.range-2*i.options.lifeSpeed||this.disableLine(i,n,t)},disableLine:function(i,n,t){t.splice(n,1),i.pause(),i.hide(),this.unusing.push(i)},disable:function(){this.isable=!1},enable:function(){this.isable=!0},initEventsLine:function(i){var n=this;i.on("mouseover",function(t){i.pause(),n.emit("child-mouseover",t)}).on("mouseout",function(t){i.resume(),n.emit("child-mouseout",t)}).on("click",function(i){n.emit("child-click",i)})},update:function(){this.updateLife()},updateOptions:function(i){this.options=o.deepMerge(this.options,i),this.each(function(n){n.updateOptions(i.flying)})},initEvents:function(){},loop:function(){this.update(),this.isable&&window.requestAnimationFrame(this.loop.bind(this))},updateLife:function(){for(var i,n=this.using,t=n.length-1;t>=0;t--)i=n[t],i.isLive&&i._updateLife(),this.checkLine(i,t,n)},remove:function(){this.using=[],this.unusing=[];this._map;this.lines.forEach(function(i){var n=i.displayPath;n&&n.destroy();var t=i.interactivePath;t&&t.destroy()}),this.disable(),this.lines=[],this._data=null},each:function(i){return this.lines.forEach(i)}}),a.FlyingLines=i,a.flyingLine=function(n){return new i(n)},module.exports=i;