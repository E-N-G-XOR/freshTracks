"use strict";var t=require("./../leaflet"),i=require("./../core/utils"),e=t.dmap=t.dmap||{},a=t.Path.extend({options:{weight:10,opacity:1,color:"blue",kHeight:.5},initialize:function(e){e=this.options=i.deepMerge(this.options,e),t.Util.setOptions(this,e),this.isInit=!1},initSvg:function(){if(!this.isInit){var t=this.options,e=i.getId("flyingPath2d"),a=(t.color,this.linearGradientId=e+"grad"),n=document.getElementsByTagName("svg")[0];if(!n)return console.log("svg节点尚未建立");var s=document.getElementsByTagName("defs")[0];s||(s=document.createElementNS("http://www.w3.org/2000/svg","defs"),n.appendChild(s));var h=this._path;if(!h)return console.log("path不存在");var r=this.linearGradient=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");"left"===this.direction&&(r.setAttribute("x1","100%"),r.setAttribute("y1","0%"),r.setAttribute("x2","0%"),r.setAttribute("y2","0%")),r.setAttribute("id",a),s.appendChild(r),this._init&&this._init(h,r),this.isInit=!0}},_project:function(){},_update:function(){},updateOptions:function(t){t=this.options=i.deepMerge(this.options,t),this._path.setAttribute("stroke-width",t.weight),this.updatePath(),this.redraw()},data:function(i){if(i&&i.from&&i.to){this._data=i;var e=this.from=t.latLng(i.from.lat,i.from.lng),a=this.to=t.latLng(i.to.lat,i.to.lng);this._latlngs=[e,a];var n=this.linearGradient;a.lng>e.lng?(this.direction="right",n.setAttribute("x1","0%"),n.setAttribute("x2","100%")):(this.direction="left",n.setAttribute("x1","100%"),n.setAttribute("x2","0%")),this.wake(),this.updatePath(),this.redraw(),this.addEventsMap()}},addTo:function(t){return t?(this._map=t,t.addLayer(this),this.initSvg(),this.updatePath=this.updatePath.bind(this),this.updatePath(),this.redraw(),this):void 0},addEventsMap:function(){this._map.on("zoomend",this.updatePath),this.updatePath()},updatePath:function(){var t=this.from,e=this.to,a=this.options;if(t&&e){var n=this._map,s=a.kHeight,h=this.fromPt=n.latLngToLayerPoint([t.lat,t.lng]),r=this.toPt=n.latLngToLayerPoint([e.lat,e.lng]),o=(r.x+h.x)/2,d=(r.y+h.y)/2,u=r.x-h.x,l=u*s;d+=-Math.abs(l);var p=i.switchValue(a.weight,this._data);this._path.setAttribute("stroke-width",p),this._path.setAttribute("d","M"+h.x+" "+h.y+" Q "+o+" "+d+" "+r.x+" "+r.y),this._customData="M"+h.x+" "+h.y+" Q "+o+" "+d+" "+r.x+" "+r.y,this.getPathString()}},getPathString:function(){var t=this._customData;return t instanceof Array?t.join(" "):t},hide:function(){this._path.setAttribute("display","none")},wake:function(){this._path.setAttribute("display","block")},destroy:function(){this._map.off("zoomend",this.updatePath);var t=document.getElementsByTagName("defs")[0],i=document.getElementById(this.linearGradientId);i&&t&&t.removeChild(i);var e=this._path,a=e.parentNode,n=document.getElementsByTagName("svg")[0];if(a&&n)try{n.removeChild(e)}catch(s){}}});e.FlyingLinePath=a,e.flyingLinePath=function(t){return new e.FlyingLinePath(t)},module.exports=a;